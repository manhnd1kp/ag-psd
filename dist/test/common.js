"use strict";
/// <reference types="mocha" />
/// <reference path="../../typings/chai.d.ts" />
/// <reference path="../../typings/canvas.d.ts" />
Object.defineProperty(exports, "__esModule", { value: true });
exports.expectBuffersEqual = exports.compareBuffers = exports.compareCanvases = exports.compareTwoFiles = exports.loadCanvasFromFile = exports.saveCanvas = exports.extractPSD = exports.readPsdFromFile = exports.createReaderFromBuffer = exports.loadImagesFromDirectory = exports.importPSD = exports.range = exports.repeat = exports.toArrayBuffer = exports.createCanvas = void 0;
require('source-map-support').install();
var fs = require("fs");
var path = require("path");
var canvas_1 = require("canvas");
Object.defineProperty(exports, "createCanvas", { enumerable: true, get: function () { return canvas_1.createCanvas; } });
require("../initializeCanvas");
var psdReader_1 = require("../psdReader");
var descriptor_1 = require("../descriptor");
descriptor_1.setLogErrors(true);
var resultsPath = path.join(__dirname, '..', '..', 'results');
function toArrayBuffer(buffer) {
    var ab = new ArrayBuffer(buffer.length);
    var view = new Uint8Array(ab);
    for (var i = 0; i < buffer.length; ++i) {
        view[i] = buffer[i];
    }
    return ab;
}
exports.toArrayBuffer = toArrayBuffer;
function repeat(times) {
    var values = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        values[_i - 1] = arguments[_i];
    }
    if (!values.length) {
        throw new Error('missing values');
    }
    var array = [];
    for (var i = 0; i < times; i++) {
        array.push.apply(array, values);
    }
    return array;
}
exports.repeat = repeat;
function range(start, length) {
    var array = [];
    for (var i = 0; i < length; i++) {
        array.push(start + i);
    }
    return array;
}
exports.range = range;
function importPSD(dirName) {
    var dataPath = path.join(dirName, 'data.json');
    if (!fs.existsSync(dataPath))
        return undefined;
    return JSON.parse(fs.readFileSync(dataPath, 'utf8'));
}
exports.importPSD = importPSD;
function loadImagesFromDirectory(dirName) {
    var images = {};
    fs.readdirSync(dirName)
        .filter(function (f) { return /\.png$/.test(f); })
        .forEach(function (f) { return images[f] = loadCanvasFromFile(path.join(dirName, f)); });
    return images;
}
exports.loadImagesFromDirectory = loadImagesFromDirectory;
function createReaderFromBuffer(buffer) {
    return psdReader_1.createReader(buffer.buffer, buffer.byteOffset, buffer.byteLength);
}
exports.createReaderFromBuffer = createReaderFromBuffer;
function readPsdFromFile(fileName, options) {
    var buffer = fs.readFileSync(fileName);
    var reader = createReaderFromBuffer(buffer);
    return psdReader_1.readPsd(reader, options);
}
exports.readPsdFromFile = readPsdFromFile;
function extractPSD(filePath, psd) {
    var basePath = path.join(resultsPath, filePath);
    if (!fs.existsSync(basePath))
        fs.mkdirSync(basePath);
    if (psd.canvas) {
        fs.writeFileSync(path.join(basePath, 'canvas.png'), psd.canvas.toBuffer());
        psd.canvas = undefined;
    }
    psd.children.forEach(function (l, i) {
        if (l.canvas) {
            fs.writeFileSync(path.join(basePath, "layer-" + i + ".png"), l.canvas.toBuffer());
            l.canvas = undefined;
        }
    });
    fs.writeFileSync(path.join(basePath, 'data.json'), JSON.stringify(psd, null, 2));
}
exports.extractPSD = extractPSD;
function saveCanvas(fileName, canvas) {
    if (canvas) {
        fs.writeFileSync(fileName, canvas.toBuffer());
    }
}
exports.saveCanvas = saveCanvas;
function loadCanvasFromFile(filePath) {
    var img = new canvas_1.Image();
    img.src = fs.readFileSync(filePath);
    var canvas = canvas_1.createCanvas(img.width, img.height);
    canvas.getContext('2d').drawImage(img, 0, 0);
    return canvas;
}
exports.loadCanvasFromFile = loadCanvasFromFile;
function compareTwoFiles(expectedPath, actual, name) {
    var expectedBuffer = fs.readFileSync(expectedPath);
    var expected = new Uint8Array(expectedBuffer.buffer, expectedBuffer.byteOffset, expectedBuffer.byteLength);
    if (expected.byteLength !== actual.byteLength) {
        throw new Error("File size is different than expected (" + name + ")");
    }
    for (var i = 0; i < expected.byteLength; i++) {
        if (expected[i] !== actual[i]) {
            throw new Error("Actual file different than expected at index " + i + ": actual " + actual[i] + ", expected " + expected[i]);
        }
    }
}
exports.compareTwoFiles = compareTwoFiles;
function compareCanvases(expected, actual, name) {
    var saveFailure = function () {
        var failuresDir = path.join(resultsPath, 'failures');
        if (!fs.existsSync(failuresDir)) {
            fs.mkdirSync(failuresDir);
        }
        fs.writeFileSync(path.join(failuresDir, "" + name.replace(/[\\/]/, '-')), actual.toBuffer());
    };
    if (expected === actual)
        return;
    if (!expected)
        throw new Error("Expected canvas is null (" + name + ")");
    if (!actual)
        throw new Error("Actual canvas is null (" + name + ")");
    if (expected.width !== actual.width || expected.height !== actual.height) {
        saveFailure();
        throw new Error("Canvas size is different than expected (" + name + ")");
    }
    var expectedData = expected.getContext('2d').getImageData(0, 0, expected.width, expected.height);
    var actualData = actual.getContext('2d').getImageData(0, 0, actual.width, actual.height);
    var length = expectedData.width * expectedData.height * 4;
    for (var i = 0; i < length; i++) {
        if (expectedData.data[i] !== actualData.data[i]) {
            saveFailure();
            var expectedNumBytes = expectedData.data.length;
            var actualNumBytes = actualData.data.length;
            throw new Error("Actual canvas (" + actualNumBytes + " bytes) different " +
                ("than expected (" + name + ": " + expectedNumBytes + " bytes) ") +
                ("at index " + i + ": actual " + actualData.data[i] + " vs. expected " + expectedData.data[i]));
        }
    }
}
exports.compareCanvases = compareCanvases;
function compareBuffers(actual, expected, test, start, offset) {
    if (start === void 0) { start = 0; }
    if (offset === void 0) { offset = 0; }
    if (!actual)
        throw new Error("Actual buffer is null or undefined (" + test + ")");
    if (!expected)
        throw new Error("Expected buffer is null or undefined (" + test + ")");
    for (var i = start; i < expected.length; i++) {
        if (expected[i] !== actual[i + offset]) {
            throw new Error("Buffers differ " +
                ("expected: 0x" + expected[i].toString(16) + " at [0x" + i.toString(16) + "] ") +
                ("actual: 0x" + actual[i + offset].toString(16) + " at [0x" + (i + offset).toString(16) + "] (" + test + ")"));
        }
    }
    if (actual.length !== expected.length)
        throw new Error("Buffers differ in size actual: " + actual.length + " expected: " + expected.length + " (" + test + ")");
}
exports.compareBuffers = compareBuffers;
function expectBuffersEqual(actual, expected, name) {
    var length = Math.max(actual.length, expected.length);
    for (var i = 0; i < length; i++) {
        if (actual[i] !== expected[i]) {
            fs.writeFileSync(path.join(__dirname, '..', '..', 'results', name), Buffer.from(actual));
            throw new Error("Different byte at 0x" + i.toString(16) + " in (" + name + ")");
        }
    }
}
exports.expectBuffersEqual = expectBuffersEqual;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxFQUFFLENBQUMsZUFBVSxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFdBQU0sSUFBSSxNQUFHLENBQUEsQ0FBQyxDQUFDO1NBQy9GO0tBQ0Q7SUFFRCxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLE1BQU07UUFDcEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQ0FBa0MsTUFBTSxDQUFDLE1BQU0sbUJBQWMsUUFBUSxDQUFDLE1BQU0sVUFBSyxJQUFJLE1BQUcsQ0FBQyxDQUFDO0FBQzVHLENBQUM7QUFoQkQsd0NBZ0JDO0FBR0QsU0FBZ0Isa0JBQWtCLENBQUMsTUFBa0IsRUFBRSxRQUFvQixFQUFFLElBQVk7SUFDeEYsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUV4RCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2hDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM5QixFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN6RixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF1QixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxhQUFRLElBQUksTUFBRyxDQUFDLENBQUM7U0FDdEU7S0FDRDtBQUNGLENBQUM7QUFURCxnREFTQyIsImZpbGUiOiJ0ZXN0L2NvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwibW9jaGFcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvY2hhaS5kLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2NhbnZhcy5kLnRzXCIgLz5cblxucmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0JykuaW5zdGFsbCgpO1xuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgY3JlYXRlQ2FudmFzLCBJbWFnZSB9IGZyb20gJ2NhbnZhcyc7XG5pbXBvcnQgJy4uL2luaXRpYWxpemVDYW52YXMnO1xuaW1wb3J0IHsgUHNkLCBSZWFkT3B0aW9ucyB9IGZyb20gJy4uL2luZGV4JztcbmltcG9ydCB7IHJlYWRQc2QsIGNyZWF0ZVJlYWRlciB9IGZyb20gJy4uL3BzZFJlYWRlcic7XG5pbXBvcnQgeyBzZXRMb2dFcnJvcnMgfSBmcm9tICcuLi9kZXNjcmlwdG9yJztcbmV4cG9ydCB7IGNyZWF0ZUNhbnZhcyB9O1xuXG5zZXRMb2dFcnJvcnModHJ1ZSk7XG5cbmNvbnN0IHJlc3VsdHNQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3Jlc3VsdHMnKTtcblxuZXhwb3J0IHR5cGUgSW1hZ2VNYXAgPSB7IFtrZXk6IHN0cmluZ106IEhUTUxDYW52YXNFbGVtZW50IH07XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0FycmF5QnVmZmVyKGJ1ZmZlcjogQnVmZmVyKSB7XG5cdGNvbnN0IGFiID0gbmV3IEFycmF5QnVmZmVyKGJ1ZmZlci5sZW5ndGgpO1xuXHRjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYWIpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLmxlbmd0aDsgKytpKSB7XG5cdFx0dmlld1tpXSA9IGJ1ZmZlcltpXTtcblx0fVxuXG5cdHJldHVybiBhYjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcGVhdDxUPih0aW1lczogbnVtYmVyLCAuLi52YWx1ZXM6IFRbXSk6IFRbXSB7XG5cdGlmICghdmFsdWVzLmxlbmd0aCkge1xuXHRcdHRocm93IG5ldyBFcnJvcignbWlzc2luZyB2YWx1ZXMnKTtcblx0fVxuXG5cdGNvbnN0IGFycmF5OiBUW10gPSBbXTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IHRpbWVzOyBpKyspIHtcblx0XHRhcnJheS5wdXNoKC4uLnZhbHVlcyk7XG5cdH1cblxuXHRyZXR1cm4gYXJyYXk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByYW5nZShzdGFydDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IG51bWJlcltdIHtcblx0Y29uc3QgYXJyYXk6IG51bWJlcltdID0gW107XG5cblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdGFycmF5LnB1c2goc3RhcnQgKyBpKTtcblx0fVxuXG5cdHJldHVybiBhcnJheTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGltcG9ydFBTRChkaXJOYW1lOiBzdHJpbmcpOiBQc2QgfCB1bmRlZmluZWQge1xuXHRjb25zdCBkYXRhUGF0aCA9IHBhdGguam9pbihkaXJOYW1lLCAnZGF0YS5qc29uJyk7XG5cblx0aWYgKCFmcy5leGlzdHNTeW5jKGRhdGFQYXRoKSlcblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXG5cdHJldHVybiBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhkYXRhUGF0aCwgJ3V0ZjgnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkSW1hZ2VzRnJvbURpcmVjdG9yeShkaXJOYW1lOiBzdHJpbmcpIHtcblx0Y29uc3QgaW1hZ2VzOiBJbWFnZU1hcCA9IHt9O1xuXG5cdGZzLnJlYWRkaXJTeW5jKGRpck5hbWUpXG5cdFx0LmZpbHRlcihmID0+IC9cXC5wbmckLy50ZXN0KGYpKVxuXHRcdC5mb3JFYWNoKGYgPT4gaW1hZ2VzW2ZdID0gbG9hZENhbnZhc0Zyb21GaWxlKHBhdGguam9pbihkaXJOYW1lLCBmKSkpO1xuXG5cdHJldHVybiBpbWFnZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZWFkZXJGcm9tQnVmZmVyKGJ1ZmZlcjogQnVmZmVyKSB7XG5cdHJldHVybiBjcmVhdGVSZWFkZXIoYnVmZmVyLmJ1ZmZlciwgYnVmZmVyLmJ5dGVPZmZzZXQsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRQc2RGcm9tRmlsZShmaWxlTmFtZTogc3RyaW5nLCBvcHRpb25zPzogUmVhZE9wdGlvbnMpOiBQc2Qge1xuXHRjb25zdCBidWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZU5hbWUpO1xuXHRjb25zdCByZWFkZXIgPSBjcmVhdGVSZWFkZXJGcm9tQnVmZmVyKGJ1ZmZlcik7XG5cdHJldHVybiByZWFkUHNkKHJlYWRlciwgb3B0aW9ucyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0UFNEKGZpbGVQYXRoOiBzdHJpbmcsIHBzZDogUHNkKSB7XG5cdGNvbnN0IGJhc2VQYXRoID0gcGF0aC5qb2luKHJlc3VsdHNQYXRoLCBmaWxlUGF0aCk7XG5cblx0aWYgKCFmcy5leGlzdHNTeW5jKGJhc2VQYXRoKSlcblx0XHRmcy5ta2RpclN5bmMoYmFzZVBhdGgpO1xuXG5cdGlmIChwc2QuY2FudmFzKSB7XG5cdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsICdjYW52YXMucG5nJyksIHBzZC5jYW52YXMudG9CdWZmZXIoKSk7XG5cdFx0cHNkLmNhbnZhcyA9IHVuZGVmaW5lZDtcblx0fVxuXG5cdHBzZC5jaGlsZHJlbiEuZm9yRWFjaCgobCwgaSkgPT4ge1xuXHRcdGlmIChsLmNhbnZhcykge1xuXHRcdFx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsIGBsYXllci0ke2l9LnBuZ2ApLCBsLmNhbnZhcy50b0J1ZmZlcigpKTtcblx0XHRcdGwuY2FudmFzID0gdW5kZWZpbmVkO1xuXHRcdH1cblx0fSk7XG5cblx0ZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oYmFzZVBhdGgsICdkYXRhLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkocHNkLCBudWxsLCAyKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYXZlQ2FudmFzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQpIHtcblx0aWYgKGNhbnZhcykge1xuXHRcdGZzLndyaXRlRmlsZVN5bmMoZmlsZU5hbWUsIGNhbnZhcy50b0J1ZmZlcigpKTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZENhbnZhc0Zyb21GaWxlKGZpbGVQYXRoOiBzdHJpbmcpIHtcblx0Y29uc3QgaW1nID0gbmV3IEltYWdlKCk7XG5cdGltZy5zcmMgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgpO1xuXHRjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXMoaW1nLndpZHRoLCBpbWcuaGVpZ2h0KTtcblx0Y2FudmFzLmdldENvbnRleHQoJzJkJykhLmRyYXdJbWFnZShpbWcsIDAsIDApO1xuXHRyZXR1cm4gY2FudmFzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZVR3b0ZpbGVzKGV4cGVjdGVkUGF0aDogc3RyaW5nLCBhY3R1YWw6IFVpbnQ4QXJyYXksIG5hbWU6IHN0cmluZykge1xuXHRjb25zdCBleHBlY3RlZEJ1ZmZlciA9IGZzLnJlYWRGaWxlU3luYyhleHBlY3RlZFBhdGgpO1xuXHRjb25zdCBleHBlY3RlZCA9IG5ldyBVaW50OEFycmF5KGV4cGVjdGVkQnVmZmVyLmJ1ZmZlciwgZXhwZWN0ZWRCdWZmZXIuYnl0ZU9mZnNldCwgZXhwZWN0ZWRCdWZmZXIuYnl0ZUxlbmd0aCk7XG5cblx0aWYgKGV4cGVjdGVkLmJ5dGVMZW5ndGggIT09IGFjdHVhbC5ieXRlTGVuZ3RoKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKGBGaWxlIHNpemUgaXMgZGlmZmVyZW50IHRoYW4gZXhwZWN0ZWQgKCR7bmFtZX0pYCk7XG5cdH1cblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGV4cGVjdGVkLmJ5dGVMZW5ndGg7IGkrKykge1xuXHRcdGlmIChleHBlY3RlZFtpXSAhPT0gYWN0dWFsW2ldKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdHVhbCBmaWxlIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkIGF0IGluZGV4ICR7aX06IGFjdHVhbCAke2FjdHVhbFtpXX0sIGV4cGVjdGVkICR7ZXhwZWN0ZWRbaV19YCk7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQ2FudmFzZXMoZXhwZWN0ZWQ6IEhUTUxDYW52YXNFbGVtZW50IHwgdW5kZWZpbmVkLCBhY3R1YWw6IEhUTUxDYW52YXNFbGVtZW50IHwgdW5kZWZpbmVkLCBuYW1lOiBzdHJpbmcpIHtcblx0Y29uc3Qgc2F2ZUZhaWx1cmUgPSAoKSA9PiB7XG5cdFx0Y29uc3QgZmFpbHVyZXNEaXIgPSBwYXRoLmpvaW4ocmVzdWx0c1BhdGgsICdmYWlsdXJlcycpO1xuXHRcdGlmICghZnMuZXhpc3RzU3luYyhmYWlsdXJlc0RpcikpIHtcblx0XHRcdGZzLm1rZGlyU3luYyhmYWlsdXJlc0Rpcik7XG5cdFx0fVxuXHRcdGZzLndyaXRlRmlsZVN5bmMocGF0aC5qb2luKGZhaWx1cmVzRGlyLCBgJHtuYW1lLnJlcGxhY2UoL1tcXFxcL10vLCAnLScpfWApLCBhY3R1YWwhLnRvQnVmZmVyKCkpO1xuXHR9O1xuXG5cdGlmIChleHBlY3RlZCA9PT0gYWN0dWFsKVxuXHRcdHJldHVybjtcblx0aWYgKCFleHBlY3RlZClcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGNhbnZhcyBpcyBudWxsICgke25hbWV9KWApO1xuXHRpZiAoIWFjdHVhbClcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdHVhbCBjYW52YXMgaXMgbnVsbCAoJHtuYW1lfSlgKTtcblxuXHRpZiAoZXhwZWN0ZWQud2lkdGggIT09IGFjdHVhbC53aWR0aCB8fCBleHBlY3RlZC5oZWlnaHQgIT09IGFjdHVhbC5oZWlnaHQpIHtcblx0XHRzYXZlRmFpbHVyZSgpO1xuXHRcdHRocm93IG5ldyBFcnJvcihgQ2FudmFzIHNpemUgaXMgZGlmZmVyZW50IHRoYW4gZXhwZWN0ZWQgKCR7bmFtZX0pYCk7XG5cdH1cblxuXHRjb25zdCBleHBlY3RlZERhdGEgPSBleHBlY3RlZC5nZXRDb250ZXh0KCcyZCcpIS5nZXRJbWFnZURhdGEoMCwgMCwgZXhwZWN0ZWQud2lkdGgsIGV4cGVjdGVkLmhlaWdodCk7XG5cdGNvbnN0IGFjdHVhbERhdGEgPSBhY3R1YWwuZ2V0Q29udGV4dCgnMmQnKSEuZ2V0SW1hZ2VEYXRhKDAsIDAsIGFjdHVhbC53aWR0aCwgYWN0dWFsLmhlaWdodCk7XG5cdGNvbnN0IGxlbmd0aCA9IGV4cGVjdGVkRGF0YS53aWR0aCAqIGV4cGVjdGVkRGF0YS5oZWlnaHQgKiA0O1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblx0XHRpZiAoZXhwZWN0ZWREYXRhLmRhdGFbaV0gIT09IGFjdHVhbERhdGEuZGF0YVtpXSkge1xuXHRcdFx0c2F2ZUZhaWx1cmUoKTtcblx0XHRcdGNvbnN0IGV4cGVjdGVkTnVtQnl0ZXMgPSBleHBlY3RlZERhdGEuZGF0YS5sZW5ndGg7XG5cdFx0XHRjb25zdCBhY3R1YWxOdW1CeXRlcyA9IGFjdHVhbERhdGEuZGF0YS5sZW5ndGg7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdGBBY3R1YWwgY2FudmFzICgke2FjdHVhbE51bUJ5dGVzfSBieXRlcykgZGlmZmVyZW50IGAgK1xuXHRcdFx0XHRgdGhhbiBleHBlY3RlZCAoJHtuYW1lfTogJHtleHBlY3RlZE51bUJ5dGVzfSBieXRlcykgYCArXG5cdFx0XHRcdGBhdCBpbmRleCAke2l9OiBhY3R1YWwgJHthY3R1YWxEYXRhLmRhdGFbaV19IHZzLiBleHBlY3RlZCAke2V4cGVjdGVkRGF0YS5kYXRhW2ldfWBcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQnVmZmVycyhhY3R1YWw6IEJ1ZmZlciwgZXhwZWN0ZWQ6IEJ1ZmZlciwgdGVzdDogc3RyaW5nLCBzdGFydCA9IDAsIG9mZnNldCA9IDApIHtcblx0aWYgKCFhY3R1YWwpXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBBY3R1YWwgYnVmZmVyIGlzIG51bGwgb3IgdW5kZWZpbmVkICgke3Rlc3R9KWApO1xuXHRpZiAoIWV4cGVjdGVkKVxuXHRcdHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYnVmZmVyIGlzIG51bGwgb3IgdW5kZWZpbmVkICgke3Rlc3R9KWApO1xuXG5cdGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGV4cGVjdGVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0aWYgKGV4cGVjdGVkW2ldICE9PSBhY3R1YWxbaSArIG9mZnNldF0pIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgQnVmZmVycyBkaWZmZXIgYCArXG5cdFx0XHRcdGBleHBlY3RlZDogMHgke2V4cGVjdGVkW2ldLnRvU3RyaW5nKDE2KX0gYXQgWzB4JHtpLnRvU3RyaW5nKDE2KX1dIGAgK1xuXHRcdFx0XHRgYWN0dWFsOiAweCR7YWN0dWFsW2kgKyBvZmZzZXRdLnRvU3RyaW5nKDE2KX0gYXQgWzB4JHsoaSArIG9mZnNldCkudG9TdHJpbmcoMTYpfV0gKCR7dGVzdH0pYCk7XG5cdFx0fVxuXHR9XG5cblx0aWYgKGFjdHVhbC5sZW5ndGggIT09IGV4cGVjdGVkLmxlbmd0aClcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEJ1ZmZlcnMgZGlmZmVyIGluIHNpemUgYWN0dWFsOiAke2FjdHVhbC5sZW5ndGh9IGV4cGVjdGVkOiAke2V4cGVjdGVkLmxlbmd0aH0gKCR7dGVzdH0pYCk7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdEJ1ZmZlcnNFcXVhbChhY3R1YWw6IFVpbnQ4QXJyYXksIGV4cGVjdGVkOiBVaW50OEFycmF5LCBuYW1lOiBzdHJpbmcpIHtcblx0Y29uc3QgbGVuZ3RoID0gTWF0aC5tYXgoYWN0dWFsLmxlbmd0aCwgZXhwZWN0ZWQubGVuZ3RoKTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0aWYgKGFjdHVhbFtpXSAhPT0gZXhwZWN0ZWRbaV0pIHtcblx0XHRcdGZzLndyaXRlRmlsZVN5bmMocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3Jlc3VsdHMnLCBuYW1lKSwgQnVmZmVyLmZyb20oYWN0dWFsKSk7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYERpZmZlcmVudCBieXRlIGF0IDB4JHtpLnRvU3RyaW5nKDE2KX0gaW4gKCR7bmFtZX0pYCk7XG5cdFx0fVxuXHR9XG59XG4iXSwic291cmNlUm9vdCI6Ii9ob21lL21hbmgva2FvcGl6L2VlbC9hZy1wc2Qvc3JjIn0=
